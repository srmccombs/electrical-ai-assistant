# Database Data Quality Report
## June 20, 2025

## üö® CRITICAL FINDING: Search Terms Missing!

### prod_category_cables - Your Largest Table
- **829 out of 841 products** (98.6%) have NO common_terms!
- Only 12 products have search terms populated
- **Impact**: V2 search will FAIL for 98.6% of category cables

---

## üìä Why This Matters for V2 Search

### V2 Search Dependencies:
The new V2 search relies on these columns:
1. `search_vector` (generated from other fields)
2. `computed_search_terms` (generated by triggers)
3. `common_terms` (manually populated search keywords)

### Current Search Flow:
```sql
-- V2 search query looks in these columns
WHERE 
  search_vector @@ to_tsquery('cat6')  -- Full-text search
  OR common_terms ILIKE '%cat6%'       -- Keyword search
  OR computed_search_terms ILIKE '%cat6%' -- Generated terms
```

### With 829 Missing common_terms:
- Search accuracy drops dramatically
- Many products won't be found
- Users will get poor results

---

## üîç Deep Dive: What Should Be in common_terms?

### Example for a Cat6 Cable:
```sql
-- Current (EMPTY):
common_terms = NULL or ''

-- Should be:
common_terms = 'cat6 cat 6 category6 category 6 ethernet network cable patch cord utp unshielded rj45 gigabit 1000base-t'
```

### Components of Good common_terms:
1. **Product variations**: cat6, cat 6, category 6
2. **Common misspellings**: ehternet, cat6e
3. **Synonyms**: patch cable, network cable, ethernet cord
4. **Technical specs**: gigabit, 1000base-t, utp
5. **Use cases**: data center, network, lan

---

## üõ†Ô∏è Fixing Strategy

### Option 1: Quick Fix - Populate from Existing Data
```sql
-- Generate basic common_terms from existing fields
UPDATE prod_category_cables
SET common_terms = LOWER(
  CONCAT_WS(' ',
    -- Category variations
    REPLACE(category_rating, 'Category ', 'cat'),
    REPLACE(LOWER(category_rating), 'category ', 'cat '),
    LOWER(category_rating),
    
    -- Shielding variations
    LOWER(shielding_type),
    CASE 
      WHEN shielding_type = 'UTP' THEN 'unshielded'
      WHEN shielding_type = 'STP' THEN 'shielded'
      WHEN shielding_type = 'SFTP' THEN 'screened shielded'
      ELSE ''
    END,
    
    -- Jacket variations
    LOWER(jacket_material),
    CASE
      WHEN jacket_material = 'Plenum' THEN 'cmp fire rated'
      WHEN jacket_material = 'Riser' THEN 'cmr non-plenum'
      ELSE ''
    END,
    
    -- Common terms
    'ethernet cable network patch cord rj45',
    
    -- From description
    LOWER(short_description)
  )
)
WHERE common_terms IS NULL OR common_terms = '';

-- Result: Basic search terms for all 829 products
```

### Option 2: Smart Population - Use search_terms Table
```sql
-- The search_terms table already has mappings!
-- Use it to populate common_terms intelligently

UPDATE prod_category_cables c
SET common_terms = (
  SELECT STRING_AGG(DISTINCT st.search_terms, ' ')
  FROM search_terms st
  WHERE 
    ('prod_category_cables' = ANY(st.applicable_tables))
    AND (
      c.category_rating = ANY(st.categories)
      OR c.jacket_material = ANY(st.jacket_types)
      OR c.shielding_type = ANY(st.shielding_types)
      OR c.brand = ANY(st.brands)
      OR st.categories IS NULL  -- Generic terms
    )
)
WHERE common_terms IS NULL OR common_terms = '';
```

### Option 3: AI-Enhanced Population
```sql
-- Use GPT to generate rich search terms
-- For each unique combination of category/shielding/jacket
SELECT DISTINCT
  category_rating,
  shielding_type,
  jacket_material,
  COUNT(*) as product_count
FROM prod_category_cables
GROUP BY category_rating, shielding_type, jacket_material
ORDER BY product_count DESC;

-- Then generate terms for each combination
-- Example: "Generate search keywords for Category 6 UTP Plenum ethernet cable"
```

---

## üìà Expected Impact After Fix

### Before (Current State):
- 12 products with search terms (1.4%)
- 829 products missing terms (98.6%)
- Search success rate: ~10-20%

### After Quick Fix:
- 841 products with basic terms (100%)
- Search success rate: ~60-70%

### After Smart Population:
- 841 products with rich terms (100%)
- Search success rate: ~90-95%

---

## üö¶ Data Quality Status by Table

Based on this finding, we should check ALL tables:

```sql
-- Query to run for all tables
SELECT 
  'prod_category_cables' as table_name,
  COUNT(*) as total_rows,
  COUNT(CASE WHEN common_terms IS NOT NULL AND common_terms != '' THEN 1 END) as has_terms,
  COUNT(CASE WHEN common_terms IS NULL OR common_terms = '' THEN 1 END) as missing_terms,
  ROUND(100.0 * COUNT(CASE WHEN common_terms IS NULL OR common_terms = '' THEN 1 END) / COUNT(*), 1) as missing_pct
FROM prod_category_cables;
```

### Predicted Issues in Other Tables:
- **prod_fiber_cables**: Likely 90%+ missing
- **prod_jack_modules**: Likely 95%+ missing  
- **prod_faceplates**: Likely 95%+ missing
- All tables probably have this issue!

---

## üéØ Action Plan

### Immediate (Today):
1. [ ] Run Option 1 quick fix for prod_category_cables
2. [ ] Check common_terms status for ALL tables
3. [ ] Document which tables need population

### Short-term (This Week):
1. [ ] Implement Option 2 smart population
2. [ ] Create a maintenance script to keep terms updated
3. [ ] Add validation to prevent empty common_terms

### Long-term (This Month):
1. [ ] Use AI to enhance search terms
2. [ ] Build admin UI for managing search terms
3. [ ] Create search quality metrics

---

## üìä Search Quality Metrics to Track

After fixing common_terms, monitor:
1. **Search Success Rate**: % of searches returning results
2. **Result Relevance**: Are top results correct?
3. **Search Speed**: Query execution time
4. **Term Coverage**: % of products with rich search terms

---

**CRITICAL**: V2 search cannot launch successfully with 98.6% of products missing search terms!